<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movie Posters â€” Vue Showcase</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js" defer></script>
  <script src="data/data.js" defer></script>

  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const app = Vue.createApp({
        data() {
          return {
            allItems: window.topics || [],
            currentIndex: null,
            // footer color defaults to the theme color used for titles
            footerColor: '#1a5a96',
            footerTextColor: '#fff'
          }
        },
        computed: {
          currentItem() {
            return this.allItems[this.currentIndex] || null;
          }
        },
        methods: {
          selectItem(i) {
            this.currentIndex = i;
             // If the movie object provides a textColor, use it for the footer
             const color = this.allItems[i] && this.allItems[i].textColor;
             this.footerColor = color || '#1a5a96';
             // compute readable text color for the footer
             this.footerTextColor = this.contrastColor(this.footerColor);
            const el = document.querySelector('.detail-view');
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
          },
          closeDetail() {
            this.currentIndex = null;
             // reset footer color when returning to posters
             this.footerColor = '#1a5a96';
             this.footerTextColor = '#fff';
          },
          nextItem() {
            if (this.allItems.length === 0 || this.currentIndex === null) return;
            this.currentIndex = (this.currentIndex + 1) % this.allItems.length;
            const c = this.allItems[this.currentIndex] && this.allItems[this.currentIndex].textColor;
            this.footerColor = c || '#1a5a96';
            this.footerTextColor = this.contrastColor(this.footerColor);
          },
          prevItem() {
            if (this.allItems.length === 0 || this.currentIndex === null) return;
            this.currentIndex = (this.currentIndex - 1 + this.allItems.length) % this.allItems.length;
            const c = this.allItems[this.currentIndex] && this.allItems[this.currentIndex].textColor;
            this.footerColor = c || '#1a5a96';
            this.footerTextColor = this.contrastColor(this.footerColor);
          },

          youtubeEmbed(trailer) {
            if (!trailer) return '';

            if (trailer.includes('youtube.com/embed') || trailer.includes('youtube-nocookie.com')) return trailer;
            let idMatch = trailer.match(/youtu\.be\/([A-Za-z0-9_-]{6,})/);

            if (idMatch && idMatch[1]) return 'https://www.youtube.com/embed/' + idMatch[1];
            idMatch = trailer.match(/[?&]v=([A-Za-z0-9_-]{6,})/);

            if (idMatch && idMatch[1]) return 'https://www.youtube.com/embed/' + idMatch[1];
            return 'https://www.youtube.com/embed/' + trailer;
          }
        ,
          // Return either '#000' or '#fff' depending on background luminance
          contrastColor(hex) {
            if (!hex) return '#fff';
            // normalize
            const h = hex.replace('#', '');
            const bigint = parseInt(h.length === 3 ? h.split('').map(c => c + c).join('') : h, 16);
            const r = (bigint >> 16) & 255;
            const g = (bigint >> 8) & 255;
            const b = bigint & 255;
            // relative luminance
            const luminance = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
            return luminance > 0.6 ? '#000' : '#fff';
          }
        }
      });

      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const vm = app._instance && app._instance.proxy;
          if (vm && vm.currentIndex !== null) vm.currentIndex = null;
        }
      });

      app.mount('#app');
    });
  </script>

</head>
<body>

  <div id="app">

    <h1 style="text-align:center; color:#1a5a96; margin-bottom:0.5rem;">Movie Posters</h1>
  <p style="text-align:center; margin-top:0; margin-bottom:1rem; color:#555;">Click a poster to show the movie description</p>

    <div class="gallery" v-if="currentIndex === null">
      <div class="thumb" v-for="(item, i) in allItems" :key="i" @click="selectItem(i)" :title="item.title">
        <img :src="item.img" :alt="item.title">
      </div>
    </div>

    <div class="detail-view" v-else-if="currentIndex !== null">
      <div class="detail-poster poster">
        <img :src="currentItem.img" :alt="currentItem.title">
      </div>

      <div class="detail-info">
        <h2>
          <a v-if="currentItem.infoUrl" :href="currentItem.infoUrl" target="_blank" rel="noopener noreferrer">{{ currentItem.title }}</a>
          <span v-else>{{ currentItem.title }}</span>
        </h2>
        <p>{{ currentItem.desc }}</p>
      </div>

      <div v-if="currentItem.trailer" style="width:100%; max-width:760px; margin-top:1rem;">
        <div style="position:relative; padding-top:56.25%; background:#000; border-radius:8px; overflow:hidden;">
          <iframe :src="youtubeEmbed(currentItem.trailer)" title="Trailer" style="position:absolute; inset:0; width:100%; height:100%; border:0;" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
        </div>
      </div>

      <div class="navigation">
        <button @click="prevItem">Previous</button>
        <button @click="nextItem">Next</button>
      </div>

      <div class="home" style="text-align:center; margin-top:1rem;">
        <button style="background:#6c757d;" @click="closeDetail">Back to posters</button>
      </div>
    </div>

    <!-- Footer: stays at bottom and takes the current footerColor -->
    <footer id="site-footer" :style="{ backgroundColor: footerColor }" v-if="true">
      <div class="footer-inner">
        <span :style="{ color: footerTextColor, fontWeight: 600 }">Cinema Explorer</span>
      </div>
    </footer>

  </div>

  

</body>
</html>
